<!DOCTYPE html>
<html>

  <head>
    <meta charset='utf-8'>
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <meta name="description" content="fmek : Emulating a JEE 7 container with SpringBoot.">
    <meta name="google-site-verification" content="bo5W8vEDgyVsZuVtrkiwBpZ-ELcVTukoE9MVvTvV42Q" />

    <link rel="stylesheet" type="text/css" media="screen" href="stylesheets/stylesheet.css">

    <title>fmek</title>
  </head>

  <body>

    <!-- HEADER -->
    <div id="header_wrap" class="outer">
        <header class="inner">
          <a id="forkme_banner" href="https://github.com/thma/fmek">View on GitHub</a>

          <h1 id="project_title">fmek</h1>
          <h2 id="project_tagline">Emulating a JEE 7 container with SpringBoot.</h2>

            <section id="downloads">
              <a class="zip_download_link" href="https://github.com/thma/fmek/zipball/master">Download this project as a .zip file</a>
              <a class="tar_download_link" href="https://github.com/thma/fmek/tarball/master">Download this project as a tar.gz file</a>
            </section>
        </header>
    </div>

    <!-- MAIN CONTENT -->
    <div id="main_content_wrap" class="outer">
      <section id="main_content" class="inner">
        <h1>
<a id="fmek" class="anchor" href="#fmek" aria-hidden="true"><span class="octicon octicon-link"></span></a>fmek</h1>

<p>Emulating a JEE 7 container with SpringBoot.</p>

<blockquote>
<p>"The Fmeks are a diminutive sapient species native to the planet Fmoo, they are the sworn enemies of the Arquillians."<br>
-- <a href="http://aliens.wikia.com/wiki/Fmek">aliens.wikia</a></p>
</blockquote>

<h2>
<a id="use-cases" class="anchor" href="#use-cases" aria-hidden="true"><span class="octicon octicon-link"></span></a>Use cases</h2>

<ul>
<li>
<p><strong>unit testing of JEE components</strong><br>
Unit testing JEE components can be quite a hazzle if you want to test across different software layers (without using mocks) or if you want to test container provided features like JTA transactions including two phase commit synchronizing different XA resources.  </p>

<p>Typical solutions use specialized Junit Testrunners like CDI-Unit CdiRunner or the DeltaSpike CdiTestRunner which provide a Weld CDI container for unit tests. This is great for testing CDI dependency injection. But integrating JAX-RS or JTA with this approach is far from trivial.  </p>

<p>The classical fullblown approach is to use tools like Arquillian which provide the complete JEE infrastructure to your junit tests. The downside with Arquillian is that the assembly of the container can be quite complex and tends to slow down the execution of the junit tests.  </p>

<p>The <strong>fmek</strong> approach is simple: just provide all required JEE dependencies of your application by a SpringBoot Maven POM. The Junit test will be executed by the SpringJUnit4ClassRunner which sets up the Spring container serving all required components:</p>

<pre><code>@RunWith(SpringJUnit4ClassRunner.class)
@ContextConfiguration(classes = {HelloWorldRestApplication.class, 
                                 EmulateJeeContainerConfiguration.class})
public class GreetingTests {

  @Inject
  private CountService countService;

  @Inject
  private GreetingCrudService greetingCrudService;

  @Inject
  private GreetingPostingService postingService;

  private static final String template = "Hello, %s!";

  @Test
  @Transactional
  public void testGreetings() throws JMSException {
    createAndSaveAGreeting();
    createAndSaveAGreeting();
    createAndSaveAGreeting();

    Greeting g = greetingCrudService.getGreeting(1);
    assertNotNull(g);
    assertEquals(1, g.getId());
    assertEquals("Hello, user-1!", g.getContent());

    List&lt;Greeting&gt; allGreetings =  greetingCrudService.getAllGreetings();
    assertEquals(3, allGreetings.size());
  }

  private void createAndSaveAGreeting() throws JMSException {
    long id = countService.incrementAndGet();
    Greeting greeting = new Greeting(id, String.format(template, "user-" + id));
    greetingCrudService.store(greeting);
    postingService.sendGreeting(greeting);
  }

}  
</code></pre>
</li>
<li>
<p><strong>Providing a lightweight JEE 7 runtime container based on SpringBoot</strong><br>
Of course a Spring container is not only useful in a testing environment but can also be used as a full-fledged deployment and runtime environment for production.</p>

<p>All you need is a main class that is annotated as <code>@SpringBootApplication</code> that starts up the Spring container by calling <code>SpringApplication.run</code>:</p>

<pre><code>@SpringBootApplication
public class HelloWorldRestApplication extends ResourceConfig {

    public HelloWorldRestApplication() {
      register(RequestContextFilter.class);
      register(HelloWorldResource.class);
    }

  public static void main(String[] args) {
    Object[] contextClasses = {HelloWorldRestApplication.class, EmulateJeeContainerConfiguration.class};
    SpringApplication.run(contextClasses, args);
  }
}
</code></pre>

<p>By calling <code>mvn install</code> this main class and all its dependencies are assembled to an executable jar. Thus no application deployment is needed.   </p>

<p>You can even add extended support for application monitoring and managing by adding a dependency to Spring Boot Actuator in your POM File:</p>

<pre><code>&lt;dependency&gt;
    &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
    &lt;artifactId&gt;spring-boot-starter-actuator&lt;/artifactId&gt;
&lt;/dependency&gt;
</code></pre>
</li>
<li>
<p><strong>Developing Spring application with minimal code dependencies on Spring</strong><br>
If you don't intend to deploy your application to a JEE container it still makes sense to minimize explicit Spring dependencies in your code. As an example have a look at the following service class which exclusively uses JEE standard APIs can be completely managed by Spring:</p>

<pre><code>package org.fmek.example.services;

import org.fmek.example.domain.Greeting;
import javax.inject.Inject;
import javax.inject.Named;
import javax.persistence.EntityManager;
import javax.persistence.TypedQuery;
import javax.transaction.Transactional;
import java.util.List;

@Named
@Transactional
public class GreetingCrudService {

  @Inject
  private EntityManager entityManager;

  public void store(Greeting g) {
    entityManager.merge(g);
  }

  public List&lt;Greeting&gt; getAllGreetings() {
    TypedQuery&lt;Greeting&gt; q = entityManager.createQuery("SELECT g FROM Greeting g", Greeting.class);
    return q.getResultList();
  }

  public Greeting getGreeting(long id) {
    return entityManager.find(Greeting.class, id);
  }
}
</code></pre>
</li>
</ul>

<h2>
<a id="supported-features" class="anchor" href="#supported-features" aria-hidden="true"><span class="octicon octicon-link"></span></a>Supported Features:</h2>

<ul>
<li>CDI</li>
<li>JTA</li>
<li>JPA</li>
<li>JMS</li>
<li>Message Driven Beans</li>
<li>JAX-RS</li>
<li>Servlets</li>
</ul>

<h2>
<a id="not-supported" class="anchor" href="#not-supported" aria-hidden="true"><span class="octicon octicon-link"></span></a>Not supported:</h2>

<ul>
<li>EJB Session Beans</li>
</ul>
      </section>
    </div>

    <!-- FOOTER  -->
    <div id="footer_wrap" class="outer">
      <footer class="inner">
        <p class="copyright">fmek maintained by <a href="https://github.com/thma">thma</a></p>
        <p>Published with <a href="https://pages.github.com">GitHub Pages</a></p>
      </footer>
    </div>

    

  </body>
</html>
